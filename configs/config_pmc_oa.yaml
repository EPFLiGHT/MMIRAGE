engine:
  model_path: Qwen/Qwen3-VL-8B-Instruct
  tp_size: 4
  trust_remote_code: true

sampling_params:
  temperature: 0.1
  top_p: 0.95
  max_new_tokens: 768

processing_gen_params:
  datasets:
    - path: path/to/your/dataset
      type: loadable
  output_dir: /capstor/store/cscs/swissai/a127/homes/$USER/datasets/pmc_oa_enhanced/shards
  num_shards: "$SLURM_ARRAY_TASK_COUNT"
  shard_id: "$SLURM_ARRAY_TASK_ID"
  conversations_field: "conversations"
  batch_size: 64

processing_params:
  inputs:
    - name: medical_image
      key: image
      type: image  # Image field from PMC-OA dataset
      image_base_path: /path/to/images  # Base directory where images are stored (e.g., extracted images.zip)
    - name: original_caption
      key: caption
      type: text

  outputs:
    - name: enhanced_medical_caption
      type: llm
      output_type: plain
      prompt: |
        Analyze the image and enhance the caption in a markdown format.
        
        Original: {original_caption}
      output_schema:
        - question
        - explanation
        - answer

  output_schema:
    image: "{medical_image}"  # Preserve original image
    caption: "{enhanced_medical_caption}"  # Enhanced caption
    original_caption: "{original_caption}"  # Keep original for reference
